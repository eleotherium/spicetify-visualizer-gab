"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.minifyFile = exports.minifyCSS = exports.minifyJS = exports.minifyFolder = void 0;
const glob_1 = __importDefault(require("glob"));
const path_1 = __importDefault(require("path"));
const fs_1 = __importDefault(require("fs"));
const uglify_js_1 = __importDefault(require("uglify-js"));
const clean_css_1 = __importDefault(require("clean-css"));
const cleanCSS = new clean_css_1.default();
const minifyJS = async (code) => {
    return uglify_js_1.default.minify(code).code;
};
exports.minifyJS = minifyJS;
const minifyCSS = async (code) => {
    return cleanCSS.minify(code).styles;
};
exports.minifyCSS = minifyCSS;
const minifyFile = async (file) => {
    const ext = path_1.default.extname(file);
    const content = fs_1.default.readFileSync(file).toString();
    let minifiedContent;
    if (ext === ".js") {
        minifiedContent = await minifyJS(content);
    }
    else if (ext === ".css") {
        minifiedContent = await minifyCSS(content);
    }
    else {
        throw new Error("File extension not supported");
    }
    fs_1.default.writeFileSync(file, minifiedContent);
};
exports.minifyFile = minifyFile;
const minifyFolder = async (directory) => {
    const jsFiles = glob_1.default.sync(path_1.default.join(directory, "/*(*.js)"), { absolute: true });
    for (const jsFile of jsFiles) {
        fs_1.default.writeFileSync(jsFile, await minifyJS(fs_1.default.readFileSync(jsFile).toString()));
    }
    const cssFiles = glob_1.default.sync(path_1.default.join(directory, "/*(*.css)"), { absolute: true });
    for (const cssFile of cssFiles) {
        fs_1.default.writeFileSync(cssFile, await minifyCSS(fs_1.default.readFileSync(cssFile).toString()));
    }
};
exports.minifyFolder = minifyFolder;
